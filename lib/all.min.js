"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_keyframe=require("keyframe"),_keyframe2=_interopRequireDefault(_keyframe),_raf=require("raf"),_raf2=_interopRequireDefault(_raf),_css=require("stylefire/css"),_css2=_interopRequireDefault(_css),_easing=require("popmotion/easing"),_keyframes=require("popmotion/animations/keyframes"),_keyframes2=_interopRequireDefault(_keyframes),_spring=require("popmotion/animations/spring"),_spring2=_interopRequireDefault(_spring),_tween=require("popmotion/animations/tween"),_tween2=_interopRequireDefault(_tween),_value=require("popmotion/reactions/value"),_value2=_interopRequireDefault(_value),_transformers=require("popmotion/transformers"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _objectWithoutProperties(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var getBox=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).getMargins,n=void 0!==t&&t,r=e.getBoundingClientRect(),i=getComputedStyle(e);return{top:r.top+window.scrollY-(n?parseInt(i.marginTop,10):0),left:r.left+window.scrollX-(n?parseInt(i.marginLeft,10):0),width:r.width+(n?parseInt(i.marginLeft,10)+parseInt(i.marginRight,10):0),height:r.height+(n?parseInt(i.marginTop,10)+parseInt(i.marginBottom,10):0)}},fadeOutTween=function(e){var n=e.element,t=e.options,r=void 0===t?{}:t;return(0,_tween2.default)(Object.assign({from:1,to:0,ease:_easing.linear},r)).start(function(e){var t=n;1===(t.style.opacity=e)&&(t.style.pointerEvents="all")})},fadeInTween=function(e){var n=e.element,t=e.options,r=void 0===t?{}:t,i=(0,_css2.default)(n);return(0,_keyframes2.default)(Object.assign({values:[{opacity:0},{opacity:1}],easings:_easing.linear,times:[.8,1]},r)).start(function(e){var t=n;i.set(e),1===e.opacity&&(t.style.pointerEvents="all")}).pause()},hideTween=function(e){var t=e.element;return{seek:(0,_transformers.pipe)(Math.round,function(e){t.style.visibility=0<e?"hidden":"visible"})}},hide=function(t){return function(e){return t.set({opacity:e,visibility:0<e?"visible":"hidden"})}},diffRect=function(e,t){return{translateY:e.top-t.top,translateX:e.left-t.left,scaleY:e.height/t.height,scaleX:e.width/t.width}},Morph=function(e){function o(){var e,t,w;_classCallCheck(this,o);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=w=_possibleConstructorReturn(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(r)))).state={state:"from"},w.elementFrom={},w.elementTo={},w.elementsCloned=[],w.hideElements=[],w.fadeInElements=[],w.fadeOutElements=[],w.isPlaying=!1,w.timeline=[],w.hide=function(n){return{ref:function(e){var t=e;w.hideElements.push({element:t,options:n})}}},w.progress=(0,_value2.default)(0,w.seek),w.fadeIn=function(n){return{ref:function(e){var t=e;t&&(t.style.willChange="opacity",t.style.pointerEvents="none",t.style.opacity=0,w.fadeInElements.push({element:t,options:n}))}}},w.fadeOut=function(n){return{ref:function(e){var t=e;t&&(t.style.willChange="opacity",w.fadeOutElements.push({element:t,options:n}))}}},w.from=function(n,r){return{ref:function(e){var t=e;t&&!w.elementFrom[n]&&(t.style.willChange="transform",w.elementFrom[n]={element:t,options:r})}}},w.to=function(n,r){return{ref:function(e){var t=e;t&&!w.elementTo[n]&&(t.style.visibility="hidden",t.style.opacity=0,t.style.willChange="transform",w.elementTo[n]={element:t,options:r})}}},w.go=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};w.timeline.length?(0,_spring2.default)(Object.assign({from:w.progress.get(),to:e},w.props.spring,t)).start(function(e){w.progress.update(e),w.seek(e)}):w.init(e)},w.seek=function(t){1!==t&&0!==t||w.setState({state:t?"to":"from"}),w.timeline.forEach(function(e){return e.seek(t)})},w.morph=function(e){var t=w.elementFrom[e],n=t.element,r=t.options,i=(r=void 0===r?{}:r).zIndex,o=r.getMargins,a=void 0===o||o,s=r.easing,l=void 0===s?function(e){return e}:s,u=_objectWithoutProperties(r,["zIndex","getMargins","easing"]),p=w.elementTo[e].element,f=getBox(n,{getMargins:a}),c=getBox(p,{getMargins:a}),m=document.createElement("div"),d=n.cloneNode(!0);m.appendChild(d);var _=(0,_css2.default)(n),h=(0,_css2.default)(m),y=(0,_css2.default)(p);h.set(Object.assign({position:"absolute",transformOrigin:"top left",pointerEvents:"none"},f,u,{zIndex:i})),y.set({"transform-origin":"top left",visibility:"visible"}),w.props.portalElement.appendChild(m),w.elementsCloned=[].concat(_toConsumableArray(w.elementsCloned),[m]);var g=diffRect(c,f),b=(0,_util.interpolateObject)({translateX:0,translateY:0,scaleX:1,scaleY:1},g),v=diffRect(f,c),O=(0,_util.interpolateObject)(v,{translateX:0,translateY:0,scaleX:1,scaleY:1});w.timeline.push({seek:(0,_keyframe2.default)({.01:function(e){hide(_)(1-e)},30:function(){},100:function(e){hide(h)(1-e)}})},{seek:(0,_keyframe2.default)({100:function(e){(0,_transformers.pipe)(l,b,h.set)(e),(0,_transformers.pipe)(l,O,y.set)(e)}})},{seek:(0,_keyframe2.default)({.01:function(e){hide(h)(e)},30:function(e){return hide(y)(e)}})}),w.isPlaying=!0},w.init=function(e){if(!w.timeline.length){Object.keys(w.elementFrom).forEach(w.morph);var t=w.fadeOutElements.map(fadeOutTween),n=w.fadeInElements.map(fadeInTween),r=w.hideElements.map(hideTween);w.timeline=[].concat(_toConsumableArray(t),_toConsumableArray(n),_toConsumableArray(r),_toConsumableArray(w.timeline)),(0,_raf2.default)(function(){return w.go(e)})}},_possibleConstructorReturn(w,t)}return _inherits(o,_react.Component),_createClass(o,[{key:"componentWillUnmount",value:function(){var t=this;this.elementsCloned.forEach(function(e){return t.props.portalElement.removeChild(e)})}},{key:"render",value:function(){var e=this.props.children({from:this.from,to:this.to,fadeIn:this.fadeIn,fadeOut:this.fadeOut,back:this.back,seek:this.seek,go:this.go,progress:this.progress,state:this.state.state,hide:this.hide,init:this.init});return e&&_react2.default.Children.only(e)}}]),o}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Morph.propTypes={portalElement:_propTypes2.default.object,children:_propTypes2.default.func.isRequired,spring:_propTypes2.default.shape({restDelta:_propTypes2.default.number,restSpeed:_propTypes2.default.number,stiffness:_propTypes2.default.number.isRequired,mass:_propTypes2.default.number,damping:_propTypes2.default.number.isRequired})},Morph.defaultProps={portalElement:global.document&&global.document.body,spring:{restDelta:.001,restSpeed:.001,damping:26,mass:1,stiffness:170}},exports.default=Morph,Object.defineProperty(exports,"__esModule",{value:!0});var getValueFromProgress=function(e,t,n){return-n*e+n*t+e},interpolateObject=exports.interpolateObject=function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(n){return Object.assign({},Object.keys(r).reduce(function(e,t){return Object.assign(_defineProperty({},t,getValueFromProgress(r[t],i[t],n)),e)},{}))}};exports.default={interpolateObject:interpolateObject};